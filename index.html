<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ç—Ä–µ–∫–µ—Ä –¥–æ–ª–≥–æ–≤</title>
  <link href="https://fonts.googleapis.com/css2?family=Golos+Text:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 0;
      font-family: 'Golos Text', sans-serif;
      background: #111;
      color: #eee;
      padding: 1rem;
    }
    h1, h2 {
      text-align: center;
      margin: 1rem 0;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 2rem;
    }
    th, td {
      border: 1px solid #333;
      padding: 0.5rem;
      text-align: center;
    }
    th {
      background: #222;
    }
    input {
      width: 100%;
      background: #1a1a1a;
      border: none;
      color: #eee;
      text-align: center;
      padding: 0.3rem;
    }
    input:focus { outline: 1px solid #4ade80; }
    select { margin-bottom: 1rem; background: #1a1a1a; color: #eee; padding: 0.3rem; }
    .chart-container { max-width: 800px; margin: 0 auto; }
    .achievements { margin-top: 2rem; text-align: center; }
    .achievement { display: inline-block; margin: 1rem; padding: 1rem; border: 2px solid #444; border-radius: 10px; background: #1a1a1a; color: #aaa; }
    .achievement.completed { border-color: #4ade80; background: #1f3a1f; color: #4ade80; }
  </style>
</head>

<body>
  <h1>–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ç—Ä–µ–∫–µ—Ä: –ø–ª–∞–Ω vs —Ñ–∞–∫—Ç</h1>

  <label for="year">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ–¥:</label>
  <select id="year" onchange="renderTable()">
    <option value="2025">2025</option>
    <option value="2026">2026</option>
    <option value="2027">2027</option>
    <option value="2028">2028</option>
    <option value="2029">2029</option>
    <option value="2030">2030</option>
    <option value="2031">2031</option>
    <option value="2032">2032</option>
  </select>

  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th>–ú–µ—Å—è—Ü</th>
          <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
          <th>–ü–ª–∞–Ω (‚ÇΩ)</th>
          <th>–§–∞–∫—Ç (‚ÇΩ)</th>
        </tr>
      </thead>
      <tbody id="table-body"></tbody>
    </table>
  </div>

  <div class="chart-container">
    <canvas id="planVsFactChart" height="300"></canvas>
    <canvas id="pieChart" height="300" style="margin-top: 2rem;"></canvas>
  </div>

  <div class="achievements" id="achievements">
    <div class="achievement" id="ps5-paid">üéÆ PS5 –≤—ã–ø–ª–∞—á–µ–Ω</div>
    <div class="achievement" id="card-paid">üí≥ –ö—Ä–µ–¥–∏—Ç–∫–∞ –∑–∞–∫—Ä—ã—Ç–∞</div>
    <div class="achievement" id="car-paid">üöó –ê–≤—Ç–æ –≤—ã–ø–ª–∞—á–µ–Ω</div>
    <div class="achievement" id="family-paid">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ –†–æ–¥–Ω–µ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–æ</div>
    <div class="achievement" id="mortgage-paid">üè† –ò–ø–æ—Ç–µ–∫–∞ –∑–∞–∫—Ä—ã—Ç–∞</div>
    <div class="achievement" id="pillow-ready">üõè –ü–æ–¥—É—à–∫–∞ –Ω–∞–∫–æ–ø–ª–µ–Ω–∞</div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const months = [
      "–Ø–Ω–≤–∞—Ä—å", "–§–µ–≤—Ä–∞–ª—å", "–ú–∞—Ä—Ç", "–ê–ø—Ä–µ–ª—å", "–ú–∞–π", "–ò—é–Ω—å",
      "–ò—é–ª—å", "–ê–≤–≥—É—Å—Ç", "–°–µ–Ω—Ç—è–±—Ä—å", "–û–∫—Ç—è–±—Ä—å", "–ù–æ—è–±—Ä—å", "–î–µ–∫–∞–±—Ä—å"
    ];

    const categories = ["PS5", "–ö—Ä–µ–¥–∏—Ç–∫–∞", "–ê–≤—Ç–æ–∫—Ä–µ–¥–∏—Ç", "–ú–∞–º–µ", "–†–æ–¥–∏—Ç–µ–ª—è–º", "–ò–ø–æ—Ç–µ–∫–∞"];

    const planData = {
      2025: {}, 2026: {}, 2027: {}, 2028: {}, 2029: {}, 2030: {}, 2031: {}, 2032: {}
    };

    let factData = JSON.parse(localStorage.getItem("factData")) || JSON.parse(JSON.stringify(planData));

    planData["2025"] = {
      "–ò—é–ª—å": { "PS5": 28000, "–ö—Ä–µ–¥–∏—Ç–∫–∞": 10000, "–ò–ø–æ—Ç–µ–∫–∞": 20500 },
      "–ê–≤–≥—É—Å—Ç": { "–ö—Ä–µ–¥–∏—Ç–∫–∞": 60000, "–ê–≤—Ç–æ–∫—Ä–µ–¥–∏—Ç": 35000, "–ò–ø–æ—Ç–µ–∫–∞": 20500 },
      "–°–µ–Ω—Ç—è–±—Ä—å": { "–ö—Ä–µ–¥–∏—Ç–∫–∞": 60000, "–ê–≤—Ç–æ–∫—Ä–µ–¥–∏—Ç": 35000, "–ò–ø–æ—Ç–µ–∫–∞": 20500 },
      "–û–∫—Ç—è–±—Ä—å": { "–ö—Ä–µ–¥–∏—Ç–∫–∞": 60000, "–ê–≤—Ç–æ–∫—Ä–µ–¥–∏—Ç": 35000, "–ò–ø–æ—Ç–µ–∫–∞": 20500 },
      "–ù–æ—è–±—Ä—å": { "–ê–≤—Ç–æ–∫—Ä–µ–¥–∏—Ç": 85000, "–ò–ø–æ—Ç–µ–∫–∞": 20500 },
      "–î–µ–∫–∞–±—Ä—å": { "–ê–≤—Ç–æ–∫—Ä–µ–¥–∏—Ç": 85000, "–ò–ø–æ—Ç–µ–∫–∞": 20500 },
    };

    function renderTable() {
      const year = document.getElementById("year").value;
      const tbody = document.getElementById("table-body");
      tbody.innerHTML = "";

      months.forEach(month => {
        categories.forEach(cat => {
          const tr = document.createElement("tr");
          const plan = (planData[year]?.[month]?.[cat]) || 0;
          const fact = (factData[year]?.[month]?.[cat]) || 0;
          tr.innerHTML = `
            <td>${month}</td>
            <td>${cat}</td>
            <td>${plan.toLocaleString()}</td>
            <td><input type="number" value="${fact}" onchange="updateFact('${year}','${month}','${cat}', this.value)"></td>
          `;
          tbody.appendChild(tr);
        });
      });

      updateCharts(year);
      updateAchievements();
    }

    function updateFact(year, month, cat, value) {
      if (!factData[year][month]) factData[year][month] = {};
      factData[year][month][cat] = parseInt(value) || 0;
      localStorage.setItem("factData", JSON.stringify(factData));
      updateCharts(year);
      updateAchievements();
    }

    function updateCharts(year) {
      const totalPlan = [], totalFact = [], pieData = {};
      months.forEach(month => {
        let p = 0, f = 0;
        categories.forEach(cat => {
          const plan = (planData[year]?.[month]?.[cat]) || 0;
          const fact = (factData[year]?.[month]?.[cat]) || 0;
          p += plan;
          f += fact;
          pieData[cat] = (pieData[cat] || 0) + fact;
        });
        totalPlan.push(p);
        totalFact.push(f);
      });

      const ctx = document.getElementById("planVsFactChart").getContext("2d");
      if (window.pfChart) window.pfChart.destroy();
      window.pfChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: months,
          datasets: [
            {
              label: '–ü–ª–∞–Ω (‚ÇΩ)',
              data: totalPlan,
              backgroundColor: 'rgba(59,130,246,0.6)'
            },
            {
              label: '–§–∞–∫—Ç (‚ÇΩ)',
              data: totalFact,
              backgroundColor: 'rgba(16,185,129,0.6)'
            }
          ]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              labels: { color: '#eee' }
            }
          },
          scales: {
            x: {
              ticks: { color: '#ccc' },
              grid: { color: '#222' }
            },
            y: {
              ticks: { color: '#ccc' },
              grid: { color: '#222' }
            }
          }
        }
      });

      const pieCtx = document.getElementById("pieChart").getContext("2d");
      if (window.pieChart) window.pieChart.destroy();
      window.pieChart = new Chart(pieCtx, {
        type: 'pie',
        data: {
          labels: Object.keys(pieData),
          datasets: [{
            data: Object.values(pieData),
            backgroundColor: [
              '#ef4444','#f97316','#facc15','#22c55e','#3b82f6','#a855f7'
            ]
          }]
        },
        options: {
          plugins: {
            legend: {
              labels: { color: '#eee' }
            }
          }
        }
      });
    }

    function updateAchievements() {
      const total = { PS5: 0, –ö—Ä–µ–¥–∏—Ç–∫–∞: 0, –ê–≤—Ç–æ–∫—Ä–µ–¥–∏—Ç: 0, –ú–∞–º–µ: 0, –†–æ–¥–∏—Ç–µ–ª—è–º: 0, –ò–ø–æ—Ç–µ–∫–∞: 0 };
      Object.values(factData).forEach(yearData => {
        Object.values(yearData).forEach(monthData => {
          for (const cat in monthData) {
            total[cat] += monthData[cat];
          }
        });
      });
      if (total["PS5"] >= 28000) document.getElementById("ps5-paid").classList.add("completed");
      if (total["–ö—Ä–µ–¥–∏—Ç–∫–∞"] >= 180000) document.getElementById("card-paid").classList.add("completed");
      if (total["–ê–≤—Ç–æ–∫—Ä–µ–¥–∏—Ç"] >= 1500000) document.getElementById("car-paid").classList.add("completed");
      if (total["–ú–∞–º–µ"] >= 400000 && total["–†–æ–¥–∏—Ç–µ–ª—è–º"] >= 500000) document.getElementById("family-paid").classList.add("completed");
      if (total["–ò–ø–æ—Ç–µ–∫–∞"] >= 2850008) document.getElementById("mortgage-paid").classList.add("completed");
      const allFacts = Object.values(total).reduce((a,b)=>a+b,0);
      if (allFacts >= 1300000) document.getElementById("pillow-ready").classList.add("completed");
    }

    renderTable();
  </script>
</body>
</html>
